{% extends "layout/crm-base.html" %}
{% load static %}

{% block content %}

<style>
    .bg-midnight{
        background-color: #202940 !important;
        border-color: #060d20 !important;
    }
</style>

    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:void(0)">Invoices</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="javascript:void(0)">
                  <i class="material-icons">notifications</i>
                  <p class="d-lg-none d-md-block">
                    Notifications
                  </p>
                </a>
              </li>
              <!-- your navbar here -->
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="container-fluid">
          
          <!-- Contacts -->
          <div class="row">
            <div class="col">
              <div class="card">

                <div class="card-header card-header-warning">
                  <h4 class="card-title ">
                      Invoice
                      <span class="float-right">{{invoice.invoice_number}}</span>
                    </h4>
                </div>

                <div class="card-body">
                  <div class="table-responsive col">

                        <div class="row mt-3">
                            <div class="col">
                                <div class="cssload-loader-walk float-right save_activity_animation">
                                    <div></div><div></div><div></div><div></div><div></div>
                                    <p class="mt-3 text-info text-center">Sending</p>
                                </div>
                                <button type="button" inv_number="{{invoice.invoice_number}}" receipt_email="{{invoice.invoice_receipt.email}}" class="btn mr-3 btn-info send_to_receipnt float-right">Send To Recipient</button>
                                <a target="blank" href="/images/invoices/{{invoice.invoice_number}}.pdf" class="btn btn-primary mr-3 float-right">Download Invoice</a>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col">
                                <label for="">Invoice Number</label>
                                <input type="text" value="{{invoice.invoice_number}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Order Number</label>
                                <input type="text" value="{{invoice.order_number}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Created at</label>
                                <input type="text" value="{{invoice.cratedAt}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Due</label>
                                <input type="text" value="{{invoice.due_date}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <h3>Recipient Info</h3>
                        </div>

                        <div class="row mt-2">
                            <div class="col">
                                <label for="">Recipient Name</label>
                                <input type="text" value="{{invoice.invoice_receipt.receipt_name}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Company Name</label>
                                <input type="text" value="{{invoice.invoice_receipt.company_name}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            <div class="col">
                                <label for="">Street Address</label>
                                <input type="text" value="{{invoice.invoice_receipt.street_address}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            <div class="col">
                                <label for="">City</label>
                                <input type="text" value="{{invoice.invoice_receipt.city}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">State</label>
                                <input type="text" value="{{invoice.invoice_receipt.state}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Zip</label>
                                <input type="text" value="{{invoice.invoice_receipt.receipt_zip}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            <div class="col">
                                <label for="">Phone</label>
                                <input type="text" value="{{invoice.invoice_receipt.phone}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Email</label>
                                <input type="text" value="{{invoice.invoice_receipt.email}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>



                        <div class="row mt-4">
                            <h3>Sender Info</h3>
                        </div>

                        <div class="row mt-2">
                            <div class="col">
                                <label for="">Sender Name</label>
                                <input type="text" value="{{invoice.invoice_sender.sender_name}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Street Address</label>
                                <input type="text" value="{{invoice.invoice_sender.street_address}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            <div class="col">
                                <label for="">City</label>
                                <input type="text" value="{{invoice.invoice_sender.city}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">State</label>
                                <input type="text" value="{{invoice.invoice_sender.state}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Zip</label>
                                <input type="text" value="{{invoice.invoice_sender.sender_zip}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            <div class="col">
                                <label for="">Phone</label>
                                <input type="text" value="{{invoice.invoice_sender.phone}}" class="form-control bg-midnight" readonly>
                            </div>
                            <div class="col">
                                <label for="">Email</label>
                                <input type="text" value="{{invoice.invoice_sender.email}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>
                        <br>

                        <div class="row mt-1">
                            {% if sender_logo != False %}
                            <div class="col">
                                <label for="">Company Logo</label><br>
                                <img src="{{invoice.invoice_sender.company_logo.url}}" width="200" alt="">
                            </div>
                            {% endif %}
                            <div class="col">
                                <label for="">Company Website</label>
                                <input type="text" value="{{invoice.invoice_sender.company_website}}" class="form-control bg-midnight" readonly>
                            </div>
                        </div>


                        <div class="row mt-4">
                            <h3>Items</h3>
                        </div>

                        <div class="row mt-2">
                            <div class="col">
                                <table class="table table-bordered">
                                    <thead class="thead-inverse">
                                        <tr>
                                            <th>Item Name</th>
                                            <th>Qty</th>
                                            <th>Unit Price</th>
                                            <th>Amount</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in items %}
                                            <tr>
                                                <td>{{item.item_name}}</td>
                                                <td>{{item.qty}}</td>
                                                <td>${{item.unit_price}}</td>
                                                <td>${{item.amount}}</td>
                                            </tr>
                                            {% endfor %}

                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td class="text-light"><strong>Total</strong></td>
                                                <td></td>
                                                <td  class="text-info">${{total}}</td>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td class="text-light"><strong>Discounts</strong></td>
                                                <td>{{invoice.discounts}}%</td>
                                                <td class="text-danger">${{total_discounts}}</td>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td class="text-light"><strong>Taxes</strong></td>
                                                <td>{{invoice.taxes}}%</td>
                                                <td  class="text-success">${{total_taxes}}</td>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td class="text-light"><strong>Sub Total</strong></td>
                                                <td></td>
                                                <td  class="text-info">${{sub_total}}</td>
                                            </tr>
                                        </tbody>
                                </table>
                            </div>
                        </div>

                  </div>
                </div>
              </div>

            </div>
          </div>

          {% csrf_token %}


        </div>
      </div>
      <footer class="footer">
        <div class="container-fluid">
          <nav class="float-left">
            <ul>
            </ul>
          </nav>
          <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script>, anangtawiah.com
          </div>
          <!-- your footer here -->
        </div>
      </footer>
    </div>

    <script>
        var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        var toastMixin = Swal.mixin({
            toast: true,
            icon: 'success',
            title: 'General Title',
            animation: false,
            background: 'black',
            position: 'top-right',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        });


        $(".send_to_receipnt").click(function(){

            inv_number = $(this).attr("inv_number");
            receipt_email = $(this).attr("receipt_email");

            $.ajax({
                url:"/crm/send-to-recipient/"+inv_number,
                method: 'post',
                headers: {'X-CSRFToken': csrftoken},
                data: {receipt_email:receipt_email},
                beforeSend: function(data){
                    $(".save_activity_animation").show();
                },
                success: function(data){

                    $(".save_activity_animation").hide();
                    
                    if(data == 'success'){
                        
                        toastMixin.fire({
                            animation: true,
                            title: 'Invoice sent'
                        });

                    }else{
                        
                        toastMixin.fire({
                            animation: true,
                            title: 'Invoice Sent Error',
                            icon: 'error'
                        });

                    }
                }
            })

        });

        
    </script>
  
  <style>
    .green-check{
      padding: 0.5rem;
      padding-top: 1rem;
      border: 1px solid #278267;
      border-radius: 10px;
      color: #278267;
    }

    .red-check{
      padding: 0.5rem;
      padding-top: 1rem;
      border: 1px solid #d22824;
      border-radius: 10px;
      color: #d22824;
    }

    .cssload-loader-walk {
      width: 70px;
      height: 28px;
      position: absolute;
      left: 50%;
      top: 20px;
      display: none;
      transform: translate(-50%, -50%);
        -o-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        -webkit-transform: translate(-50%, -50%);
        -moz-transform: translate(-50%, -50%);
    }
    .cssload-loader-walk > div {
      content: "";
      width: 14px;
      height: 14px;
      background: #029eb1;
      border-radius: 100%;
      position: absolute;
      animation: cssload-animate 1.5s linear infinite;
        -o-animation: cssload-animate 1.5s linear infinite;
        -ms-animation: cssload-animate 1.5s linear infinite;
        -webkit-animation: cssload-animate 1.5s linear infinite;
        -moz-animation: cssload-animate 1.5s linear infinite;
    }
    .cssload-loader-walk > div:nth-of-type(1) {
      animation-delay: -0.3s;
        -o-animation-delay: -0.3s;
        -ms-animation-delay: -0.3s;
        -webkit-animation-delay: -0.3s;
        -moz-animation-delay: -0.3s;
    }
    .cssload-loader-walk > div:nth-of-type(2) {
      animation-delay: -0.6s;
        -o-animation-delay: -0.6s;
        -ms-animation-delay: -0.6s;
        -webkit-animation-delay: -0.6s;
        -moz-animation-delay: -0.6s;
    }
    .cssload-loader-walk > div:nth-of-type(3) {
      animation-delay: -0.9s;
        -o-animation-delay: -0.9s;
        -ms-animation-delay: -0.9s;
        -webkit-animation-delay: -0.9s;
        -moz-animation-delay: -0.9s;
    }
    .cssload-loader-walk > div:nth-of-type(4) {
      animation-delay: -1.2s;
        -o-animation-delay: -1.2s;
        -ms-animation-delay: -1.2s;
        -webkit-animation-delay: -1.2s;
        -moz-animation-delay: -1.2s;
    }



    @keyframes cssload-animate {
      0% {
        left: 70px;
        top: 0;
      }
      80% {
        left: 0;
        top: 0;
      }
      85% {
        left: 0;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      90% {
        width: 28px;
        height: 10px;
      }
      95% {
        left: 70px;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      100% {
        left: 70px;
        top: 0;
      }
    }

    @-o-keyframes cssload-animate {
      0% {
        left: 70px;
        top: 0;
      }
      80% {
        left: 0;
        top: 0;
      }
      85% {
        left: 0;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      90% {
        width: 28px;
        height: 10px;
      }
      95% {
        left: 70px;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      100% {
        left: 70px;
        top: 0;
      }
    }

    @-ms-keyframes cssload-animate {
      0% {
        left: 70px;
        top: 0;
      }
      80% {
        left: 0;
        top: 0;
      }
      85% {
        left: 0;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      90% {
        width: 28px;
        height: 10px;
      }
      95% {
        left: 70px;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      100% {
        left: 70px;
        top: 0;
      }
    }

    @-webkit-keyframes cssload-animate {
      0% {
        left: 70px;
        top: 0;
      }
      80% {
        left: 0;
        top: 0;
      }
      85% {
        left: 0;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      90% {
        width: 28px;
        height: 10px;
      }
      95% {
        left: 70px;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      100% {
        left: 70px;
        top: 0;
      }
    }

    @-moz-keyframes cssload-animate {
      0% {
        left: 70px;
        top: 0;
      }
      80% {
        left: 0;
        top: 0;
      }
      85% {
        left: 0;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      90% {
        width: 28px;
        height: 10px;
      }
      95% {
        left: 70px;
        top: -14px;
        width: 14px;
        height: 14px;
      }
      100% {
        left: 70px;
        top: 0;
      }
    }

    .activity_email{
      width: 70px;
      color: #00bcd4;
      border-radius: 10px;
      border: 1px #00bcd4 solid;
      padding: 0.5rem 1rem !important;
    }

    .activity_call{
      width: 70px;
      color: crimson;
      border-radius: 10px;
      border: 1px crimson solid;
      padding: 0.5rem 1rem !important;
    }

    .activity_invoice{
      width: 70px;
      color: #f5700c;
      border-radius: 10px;
      border: 1px #f5700c solid;
      padding: 0.5rem 1rem !important;
    }

    .activity_other{
      width: 70px;
      color: #288c6c;
      border-radius: 10px;
      border: 1px #288c6c solid;
      padding: 0.5rem 1rem !important;
    }
  </style>
  

{% endblock %}